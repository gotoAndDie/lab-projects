<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" onload="parser()" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid meet">
<defs>
  <filter id="svg_1_blur" x="-50%" y="-50%" width="200%" height="200%">
   <feGaussianBlur stdDeviation="12"/>
  </filter>
  <linearGradient id="endshadgrad" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:rgb(0,0,0);stop-opacity:0.5" />
      <stop offset="50%" style="stop-color:rgb(0,0,0);stop-opacity:1" />  
      <stop offset="100%" style="stop-color:rgb(0,0,0);stop-opacity:0.5" />
  </linearGradient>
  <linearGradient id="bsg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#3333dd;stop-opacity:0" />
      <stop offset="50%" style="stop-color:#3333dd;stop-opacity:0.4" />  
      <stop offset="100%" style="stop-color#3333dd;stop-opacity:0" />
  </linearGradient>
  <linearGradient id="rsg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#dd3333;stop-opacity:0" />
      <stop offset="50%" style="stop-color:#dd3333;stop-opacity:0.4" />  
      <stop offset="100%" style="stop-color#dd3333;stop-opacity:0" />
  </linearGradient>
  <linearGradient id="ysg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#dddd33;stop-opacity:0" />
      <stop offset="50%" style="stop-color:#dddd33;stop-opacity:0.4" />  
      <stop offset="100%" style="stop-color#dddd33;stop-opacity:0" />
  </linearGradient>
  <linearGradient id="grsg" x1="0%" y1="0%" x2="100%" y2="0%">
      <stop offset="0%" style="stop-color:#33dd33;stop-opacity:0" />
      <stop offset="50%" style="stop-color:#33dd33;stop-opacity:0.4" />  
      <stop offset="100%" style="stop-color#33dd33;stop-opacity:0" />
  </linearGradient>
 
</defs>
<rect x="-10000" y="-10000" width="20000" height="20000" style="fill:#000000"/>
<rect x="0" y="0" width="100" height="100" style="fill:#263238" />
<image style="overflow:visible;" width="100" height="100" xlink:href="background.svg"/>


<rect id="col1" x="8" y="0" width="20" height="100" fill="url(#bsg)" fill-opacity="0" />
<rect id="col2" x="28" y="0" width="20" height="100" fill="url(#rsg)" fill-opacity="0"/>
<rect id="col3" x="48" y="0" width="20" height="100" fill="url(#ysg)" fill-opacity="0"/>
<rect id="col4" x="68" y="0" width="20" height="100" fill="url(#grsg)" fill-opacity="0"/>
<line id="hitbar" y2="85" x2="50" y1="85" x1="50" stroke-width="0.25" stroke="#cfd8dc" fill="none"/>
<text id="title" xml:space="preserve" text-anchor="middle" font-family="Impact, Charcoal, sans-serif" font-size="4" y="5" x="23" fill="#f0f0f0">RhyDrake by Group 2</text>
<text id="scoretxt" xml:space="preserve" text-anchor="middle" font-family="Impact, Charcoal, sans-serif" font-size="4" y="5" x="50" fill="#f0f0f0">0</text>
<text id="ln1" xml:space="preserve" text-anchor="middle" font-family="Impact, Charcoal, sans-serif" font-size="4" y="90" x="17.5" fill="#f0f0f0">Key D</text>
<text id="ln2" xml:space="preserve" text-anchor="middle" font-family="Impact, Charcoal, sans-serif" font-size="4" y="90" x="37.5" fill="#f0f0f0">Key F</text>
<text id="ln3" xml:space="preserve" text-anchor="middle" font-family="Impact, Charcoal, sans-serif" font-size="4" y="90" x="57.5" fill="#f0f0f0">Key J</text>
<text id="ln4" xml:space="preserve" text-anchor="middle" font-family="Impact, Charcoal, sans-serif" font-size="4" y="90" x="77.5" fill="#f0f0f0">Key K</text>
<rect id="endshadow" x="0" y="0" width="100" height="100" fill="url(#endshadgrad)" fill-opacity="0" />
<text id="errorretard" x="98112.6" fill="#f0f0f0">aaa</text>
<text id="thankyou" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="82.5" x="50" fill="#ef9a9a" fill-opacity="0"> Thank you for playing! Press Enter to reload.</text>
<text id="misst" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="22.5" x="50" fill="#ef9a9a"></text>
<text id="badt" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="30" x="50" fill="#ffcc80"></text>
<text id="okt" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="37.5" x="50" fill="#fff59d"></text>
<text id="goodt" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="45" x="50" fill="#c5e1a5"></text>
<text id="greatt" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="52.5" x="50" fill="#80cbc4"></text>
<text id="perfectt" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="60" x="50" fill="#ce93d8"></text>
<text id="finalscore" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="67.5" x="50" fill="#f0f0f0"></text>
<text id="rankt" xml:space="preserve" text-anchor="middle" font-family="Copperplate, Copperplate Gothic Light, fantasy, Sans-serif" font-size="4" y="75" x="50" fill="#f0f0f0"></text>
<image id="cover" style="overflow:visible;" width="100" height="100" xlink:href="cover.svg" opacity="1"/>
<rect id="untilload" x="-10000" y="-10000" width="20000" height="20000" style="fill:#000000"/>
<script xlink:href="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
<script>
<![CDATA[
var left, right
function parser(){
music.load();
hitding.load();
coverfade(120,untilload)
$(document).ready(function() {
    $.ajax({
        type: "GET",
        url: "data.csv",
        dataType: "text",
        success: function(data) {processData(data);}
     });
});
function processData(allText) {
    var allTextLines = allText.split(/\r\n|\n/);
    var headers = allTextLines[0].split(',');
    left = [];
    right = [];

    for (var i=0; i < allTextLines.length-1; i++) {
        var data = allTextLines[i].split(',');
        left[i] = parseInt(data[0]);
        right[i] = parseInt(data[1]);
    }
}}
music.addEventListener('canplaythrough', function(){misready=true;}, false);
document.addEventListener('keydown', function(event) {
    switch (event.keyCode) {
		case 32:
		if (misready=true && typeof right[208] != 'undefined' && prog === undefined){coverfade(120,cover);prog=0;setTimeout(function(){rhythmgame();},1000);} //The game shouldn't start before the parser is finished! 
		break;
		case 68:
        if(prog != undefined && end != true){scoreeval(10);}
		break;
		case 70:
        if(prog != undefined && end != true){scoreeval(30);}
		break;
		case 74:
        if(prog != undefined && end != true){scoreeval(50);}
		break;
		case 75:
        if(prog != undefined && end != true){scoreeval(70);}
		break;
		case 13:
		if(end == true){location.reload()}
        break;
    }
}, true);

var notes, time, prog, beatrate = 13.95348837209302, gonecount = 0, score = 0;
var miss=0,bad=0,ok=0,good=0,great=0,perfect=0, end = false, misready = false;
var elemarray = [], posx = [], posy = [];
var scoretxt = document.getElementById("scoretxt");
var endshadow = document.getElementById("endshadow");
var misst = document.getElementById("misst");
var badt = document.getElementById("badt");
var okt = document.getElementById("okt");
var goodt = document.getElementById("goodt");
var greatt = document.getElementById("greatt");
var perfectt = document.getElementById("perfectt");
var finalscore = document.getElementById("finalscore");
var rank = document.getElementById("rankt");
var thankyou = document.getElementById("thankyou");
var cover = document.getElementById("cover");
var untilload = document.getElementById("untilload");
var lnar = [document.getElementById("ln1"), document.getElementById("ln2"), document.getElementById("ln3"), document.getElementById("ln4")];
lnar[99] = [document.getElementById("errorretard")]; //suppresses one error. 
var col = [document.getElementById("col1"), document.getElementById("col2"), document.getElementById("col3"), document.getElementById("col4")];
var hitding = new Audio('reflectx.ogg');
var music = new Audio('music.ogg');

//BEGIN actual game
function coverfade(opac,obj){
	obj.setAttribute("opacity", opac/120);
	opac--;
	if(opac > 0) {setTimeout(function(){coverfade(opac,obj);},8.33333333333333)}
}
function rhythmgame(){
	notes = left;
	time = right; 
	
	prog = 0; 
    exphitbar(0,1,document.getElementById("hitbar"));
	setTimeout(function(){music.CurrentTime = 0;music.play()},1600);
	rhyloop();
}

function rhyloop(){
	gendrake();
	prog++;
	if (prog < notes.length) {setTimeout(function(){rhyloop();}, beatrate*time[prog-1])}
	else {setTimeout(function(){end=true},1000);setTimeout(function(){ending()},2000)}
}
function gendrake(){
	var elemgid = "elemg" + prog, elemg, elem, elem2;
	xmlns = "http://www.w3.org/2000/svg";
	elemg = document.createElementNS(xmlns, "g");
	elemg.setAttribute("id",elemgid);
	elem = document.createElementNS(xmlns, "path");
	elem.setAttribute("d","m260.40914,0l-62.36354,35.4729l0,32.81913l41.87855,2.69952l-1.80404,28.26982l-33.72115,0.89548l-25.04085,18.64174l25.04085,19.11236l30.96934,0.47062l0,14.56304l-22.28904,0.90202l0.90202,25.0866l20.9164,0.90202l0.47062,17.26256l-46.42786,-21.81842l-4.55585,49.61108l-14.5565,-6.83051l9.53003,-19.11236l-20.485,-12.759l-12.759,20.01438l-13.65449,-8.63455l15.03366,-26.83835l-1.37917,-32.34851l-30.92358,12.28838l-15.92914,27.78613l-26.42002,-12.28185l18.21034,-34.61664l-29.1653,-17.31485l-60.98437,35.04804l-0.90202,71.521l28.68815,15.92914l22.28904,-33.244l25.518,14.08589l-17.78547,29.64246l3.17668,30.49218l30.96934,-11.85698l15.51082,-29.11955l15.45852,8.15739l-12.28185,20.96215l22.75965,13.18387l10.90921,-20.90986l16.41283,9.53003l-43.72834,31.87136l43.72834,31.86482l-16.41283,9.58232l-10.90921,-20.96215l-22.75965,13.22962l12.28185,21.39355l-15.45852,7.72599l-15.51082,-29.11955l-30.96934,-11.85045l-3.17668,30.49218l17.78547,29.59016l-25.518,14.13164l-22.28904,-33.244l-28.68815,16.41283l0.90202,70.99156l60.98437,35.09379l29.1653,-16.88345l-18.21034,-35.0415l26.42002,-12.28838l15.92914,27.79266l30.92358,12.28185l1.37917,-32.29622l-15.03366,-26.89064l13.65449,-8.67377l12.759,20.06013l20.485,-12.759l-9.53003,-19.11236l14.5565,-6.83051l4.55585,49.61108l46.42786,-21.86417l-0.47062,17.78547l-20.9164,0.47062l-0.90202,25.46571l22.28904,0.47716l0,14.5565l-30.96934,0.4314l-25.04085,19.15811l25.04085,18.6352l33.72115,0.94777l1.80404,28.22406l-41.87855,3.17668l0,32.29622l62.36354,35.56441l62.36354,-35.56441l0,-32.29622l-41.87855,-3.17668l1.80404,-28.22406l33.72115,-0.94777l25.04085,-18.6352l-25.04085,-19.15811l-31.44649,-0.4314l0,-14.5565l22.34133,-0.47716l-0.47716,-25.46571l-20.9164,-0.47062l-0.94777,-17.78547l46.48015,21.86417l4.98072,-49.61108l14.5565,6.83051l-9.53003,19.11236l20.485,12.759l12.28185,-20.06013l14.13164,8.67377l-15.03366,26.89064l0.90202,32.29622l31.40074,-12.28185l15.92914,-27.79266l26.42002,12.28838l-18.21034,35.0415l29.1653,16.88345l60.98437,-35.09379l0.90202,-70.99156l-28.68815,-16.41283l-22.28904,33.244l-25.518,-14.13164l17.30832,-29.59016l-2.69952,-30.49218l-30.96934,11.85045l-15.51082,29.11955l-15.93568,-7.72599l12.759,-21.39355l-22.75965,-13.22962l-10.90921,20.96215l-16.41283,-9.58232l43.72834,-31.86482l-43.72834,-31.87136l16.41283,-9.53003l10.90921,20.90986l22.75965,-13.18387l-12.759,-20.96215l15.93568,-8.15739l15.51082,29.11955l30.96934,11.85698l2.69952,-30.49218l-17.30832,-29.64246l25.518,-14.08589l22.28904,33.244l28.68815,-15.92914l-0.90202,-71.521l-60.98437,-35.04804l-29.1653,17.31485l18.21034,34.61664l-26.42002,12.28185l-15.92914,-27.78613l-31.40074,-12.28838l-0.90202,32.34851l15.03366,26.83835l-14.13164,8.63455l-12.28185,-20.01438l-20.485,12.759l9.53003,19.11236l-14.5565,6.83051l-4.98072,-49.61108l-46.48015,21.81842l0.94777,-17.26256l20.9164,-0.90202l0.47716,-25.0866l-22.34133,-0.90202l0,-14.56304l31.44649,-0.47062l25.04085,-19.11236l-25.04085,-18.64174l-33.72115,-0.89548l-1.80404,-28.26982l41.87855,-2.69952l0,-32.81913l-62.36354,-35.4729z");
	elem.setAttribute("stroke-miterlimit",10.433);
	switch (notes[prog]){
		case 1:
		elem.setAttribute("fill","#00ffff");
		break;
		case 2:
		elem.setAttribute("fill","#ff0000");
		break;
		case 3:
		elem.setAttribute("fill","#ffff00");
		break;
		default:
		elem.setAttribute("fill","#00ff00");
	}
	elem2 = document.createElementNS(xmlns, "path");
	elem2.setAttribute("d","m260.40914,0l-62.36355,35.4729l0,32.81914l41.87855,2.69952l-1.80404,28.26982l-33.72115,0.89548l-25.04085,18.64174l25.04085,19.11235l30.96934,0.47062l0,14.56304l-22.28904,0.90202l0.90202,25.08661l20.9164,0.90202l0.47062,17.26256l-46.42787,-21.81842l-4.55585,49.61108l-14.5565,-6.83051l9.53003,-19.11236l-20.485,-12.759l-12.759,20.01438l-13.65448,-8.63455l15.03366,-26.83835l-1.37918,-32.34852l-30.92358,12.28839l-15.92915,27.78612l-26.42002,-12.28185l18.21034,-34.61663l-29.1653,-17.31486l-60.98437,35.04804l-0.90202,71.521l28.68815,15.92915l22.28903,-33.244l25.518,14.08589l-17.78547,29.64245l3.17668,30.49219l30.96934,-11.85699l15.51081,-29.11954l15.45853,8.15739l-12.28185,20.96215l22.75966,13.18387l10.9092,-20.90986l16.41284,9.53003l-43.72834,31.87136l43.72834,31.86482l-16.41284,9.58233l-10.9092,-20.96215l-22.75966,13.22962l12.28185,21.39355l-15.45853,7.72599l-15.51081,-29.11954l-30.96934,-11.85045l-3.17668,30.49219l17.78547,29.59016l-25.518,14.13164l-22.28903,-33.244l-28.68815,16.41284l0.90202,70.99156l60.98437,35.09379l29.1653,-16.88346l-18.21034,-35.0415l26.42002,-12.28838l15.92915,27.79266l30.92358,12.28185l1.37918,-32.29623l-15.03366,-26.89064l13.65448,-8.67377l12.759,20.06014l20.485,-12.75901l-9.53003,-19.11235l14.5565,-6.83051l4.55585,49.61107l46.42787,-21.86417l-0.47062,17.78548l-20.9164,0.47062l-0.90202,25.46571l22.28904,0.47715l0,14.55651l-30.96934,0.4314l-25.04085,19.15811l25.04085,18.6352l33.72115,0.94778l1.80404,28.22406l-41.87855,3.17668l0,32.29622l62.36355,35.56441l62.36354,-35.56441l0,-32.29622l-41.87855,-3.17668l1.80404,-28.22406l33.72115,-0.94778l25.04085,-18.6352l-25.04085,-19.15811l-31.44649,-0.4314l0,-14.55651l22.34133,-0.47715l-0.47716,-25.46571l-20.9164,-0.47062l-0.94777,-17.78548l46.48015,21.86417l4.98072,-49.61107l14.55651,6.83051l-9.53004,19.11235l20.485,12.75901l12.28185,-20.06014l14.13164,8.67377l-15.03366,26.89064l0.90202,32.29623l31.40074,-12.28185l15.92914,-27.79266l26.42002,12.28838l-18.21034,35.0415l29.16531,16.88346l60.98436,-35.09379l0.90202,-70.99156l-28.68814,-16.41284l-22.28904,33.244l-25.518,-14.13164l17.30832,-29.59016l-2.69952,-30.49219l-30.96934,11.85045l-15.51082,29.11954l-15.93568,-7.72599l12.759,-21.39355l-22.75965,-13.22962l-10.90921,20.96215l-16.41283,-9.58233l43.72834,-31.86482l-43.72834,-31.87136l16.41283,-9.53003l10.90921,20.90986l22.75965,-13.18387l-12.759,-20.96215l15.93568,-8.15739l15.51082,29.11954l30.96934,11.85699l2.69952,-30.49219l-17.30832,-29.64245l25.518,-14.08589l22.28904,33.244l28.68814,-15.92915l-0.90202,-71.521l-60.98436,-35.04804l-29.16531,17.31486l18.21034,34.61663l-26.42002,12.28185l-15.92914,-27.78612l-31.40074,-12.28839l-0.90202,32.34852l15.03366,26.83835l-14.13164,8.63455l-12.28185,-20.01438l-20.485,12.759l9.53004,19.11236l-14.55651,6.83051l-4.98072,-49.61108l-46.48015,21.81842l0.94777,-17.26256l20.9164,-0.90202l0.47716,-25.08661l-22.34133,-0.90202l0,-14.56304l31.44649,-0.47062l25.04085,-19.11235l-25.04085,-18.64174l-33.72115,-0.89548l-1.80404,-28.26982l41.87855,-2.69952l0,-32.81914l-62.36354,-35.4729z");
	elem2.setAttribute("stroke-miterlimit",10.433);
	elem2.setAttribute("fill","#ffffff");
	elem2.setAttribute("filter","url(#svg_1_blur)");
	elemg.appendChild(elem);
	elemg.appendChild(elem2);
	document.documentElement.appendChild(elemg);
	elemarray[prog] = document.getElementById(elemgid);
	var intprog = prog; 
	posx[intprog] = 20*notes[intprog]-10;
	posy[intprog] = -35;
	senddown(posx, posy, intprog)
}
function senddown(posx, posy, intprog){
	posy[intprog]++ 
	elemarray[intprog].setAttribute("transform", "translate("+posx[intprog]+" "+posy[intprog]+") scale(0.03)" );
	if (posy[intprog] < 100){setTimeout(function(){senddown(posx, posy, intprog);}, 8.33333333333333)} 
	else {gonecount++;
		if (posx[intprog] != 1990){score = score - 60; scoretxt.textContent = score;
		miss++;
		lnar[(posx[intprog]+10)/20-1].textContent = "Miss";
		lnar[(posx[intprog]+10)/20-1].setAttribute("fill", "#ef9a9a");
        posx[intprog]=undefined;
        posy[intprog]=undefined;
        elemarray[intprog]=undefined;
        
		}
	}
}

function exphitbar(hbx, hbc, hitbar){
	hbx = 50*(1-1/((hbc+6)/6));
	hitbar.setAttribute("x1", 50+hbx);
	hitbar.setAttribute("x2", 50-hbx);
	hbc++;
	if (hbc<120) {setTimeout(function(){exphitbar(hbx,hbc, hitbar)}, 16.6666667)}; //repeats this every frame.
}

function scoreeval(loc){
	var i, q, prox = 999, ln = loc/20-0.5, posysy = posy.length;
	for (i=gonecount; i<posysy; i++){
		if (posx[i]==loc && prox > Math.abs(85-posy[i])){
			prox = Math.abs(75-posy[i]);
			if (prox<15){flashfade((posx[i]+10)/20-1,0);posx[i]=1990}
		}
	}
	prox = Math.floor(prox/2)
	switch (prox) {
		case 4:
		score = score + 20;
		bad++;
		hitding.currentTime=0;
		hitding.play();
		lnar[ln].textContent = "Bad"; 
		lnar[ln].setAttribute("fill", "#ffcc80");
		break;
		case 3:
		score = score + 40;
		ok++;
		hitding.currentTime=0;
		hitding.play();
		lnar[ln].textContent = "OK";
		lnar[ln].setAttribute("fill", "#fff59d");
		break;
		case 2:
		score = score + 80;
		good++;
		hitding.currentTime=0;
		hitding.play();
		lnar[ln].textContent = "Good";
		lnar[ln].setAttribute("fill", "#c5e1a5");
		break;
		case 1:
		score = score + 140;
		great++;
		hitding.currentTime=0;
		hitding.play();
		lnar[ln].textContent = "Great";
		lnar[ln].setAttribute("fill", "#80cbc4");
		break;
		case 0:
		score = score + 200;
		perfect++;
		hitding.currentTime=0;
		hitding.play();
		lnar[ln].textContent = "Perfect";
		lnar[ln].setAttribute("fill", "#ce93d8");
		break;
		default:
		score = score - 60;
		miss++;
		lnar[ln].textContent = "Miss";
		lnar[ln].setAttribute("fill", "#ef9a9a");
	}
	scoretxt.textContent = score
}
function flashfade(obj,opac){
	col[obj].setAttribute("fill-opacity", 2.718281828^(opac));
	opac++
	if (opac<6) {setTimeout(function(){flashfade(obj,opac)}, 16.6666667)}
	else {flashfade2(obj,0)}
}
function flashfade2(obj,opac){
	col[obj].setAttribute("fill-opacity", 0.4-2.718281828^(opac/10));
	opac++
	if (opac<60) {setTimeout(function(){flashfade2(obj,opac)}, 16.6666667)}
}
function ending(){
	fadeblack(0);
	setTimeout(function(){endingtext()},2500);
}
function fadeblack(opac){
	opac++
	endshadow.setAttribute("fill-opacity", opac/300);
	if (opac<220) {setTimeout(function(){fadeblack(opac)},16.6666667)}
}
function endingtext(){
	misst.textContent = " Miss: " + miss + "    "
	badt.textContent = " Bad: " + bad + "    "
	okt.textContent = " OK: " + ok + "    "
	goodt.textContent = " Good: " + good + "    "
	greatt.textContent = " Great: " + great + "    "
	perfectt.textContent = " Perfect: " + perfect + "    "
	finalscore.textContent = " Your Final Score: " + score + "    "
	if (score == 41800){
		rank.textContent = "Rank: True Perfect!";
		rank.setAttribute("fill", "#ce93d8");
	}
	else 
	if (score > 40000) {
		rank.textContent = "Rank: P";
		rank.setAttribute("fill", "#ce93d8");
	}
	else if (score > 36000) {
		rank.textContent = "Rank: SS";
		rank.setAttribute("fill", "#80cbc4");
	}
	else if (score > 32000) {
		rank.textContent = "Rank: S";
		rank.setAttribute("fill", "#80cbc4");
	}
	else if (score > 30000) {
		rank.textContent = "Rank: A+";
		rank.setAttribute("fill", "#c5e1a5");
	}
	else if (score > 28000) {
		rank.textContent = "Rank: A";
		rank.setAttribute("fill", "#c5e1a5");
	}
	else if (score > 26000) {
		rank.textContent = "Rank: A-";
		rank.setAttribute("fill", "#c5e1a5");
	}
	else if (score > 24000) {
		rank.textContent = "Rank: B+";
		rank.setAttribute("fill", "#fff59d");
	}
	else if (score > 22000) {
		rank.textContent = "Rank: B";
		rank.setAttribute("fill", "#fff59d");
	}
	else if (score > 20000) {
		rank.textContent = "Rank: B-";
		rank.setAttribute("fill", "#fff59d");
	}
	else if (score > 18000) {
		rank.textContent = "Rank: C+";
		rank.setAttribute("fill", "#ffcc80");
	}
	else if (score > 16000) {
		rank.textContent = "Rank: C";
		rank.setAttribute("fill", "#ffcc80");
	}
	else if (score > 14000) {
		rank.textContent = "Rank: C-";
		rank.setAttribute("fill", "#ffcc80");
	}
	else {
		rank.textContent = "Rank: Miss";
		rank.setAttribute("fill", "#ef9a9a");
	}
	endtextfade(0)
}
function endtextfade(opac){
	opac ++;
	misst.setAttribute("fill-opacity", opac/400);
	badt.setAttribute("fill-opacity", (opac-40)/400);
	okt.setAttribute("fill-opacity", (opac-80)/400);
	goodt.setAttribute("fill-opacity", (opac-140)/400);
	greatt.setAttribute("fill-opacity", (opac-200)/400);
	perfectt.setAttribute("fill-opacity", (opac-280)/400);
	finalscore.setAttribute("fill-opacity", (opac-500)/400);
	rank.setAttribute("fill-opacity", (opac-750)/400);
	thankyou.setAttribute("fill-opacity", (opac-1300)/900);
	if (opac<2200) {setTimeout(function(){endtextfade(opac),16.6666667})}
	else {end=true}
}
]]>
</script>
</svg>
